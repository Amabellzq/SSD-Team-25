{% extends "base.html" %}

{% block title %}Shop Page - ShopMe{% endblock %}
  
{% block content %}
    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="/"><i class="fa fa-home"></i> Home</a>
                        <span>Shop</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

        <!-- Shop Section Begin -->
        <section class="shop spad">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-3">
                        <div class="shop__sidebar">
                            <div class="sidebar__categories">
                                <div class="section-title">
                                    <h4>Categories</h4>
                                </div> 
                                <div class="categories__accordion">
                                    <div class="accordion" id="accordionExample">
                                        <div class="card">
                                            <div class="card-heading active">
                                                <a href="javascript:void(0);" class="category-filter" data-filter="all">All</a>
                                            </div>
                                        </div>
                                        {% for category in categories %}
                                        <div class="card">
                                            <div class="card-heading active">
                                                <a href="javascript:void(0);" class="category-filter" data-filter="{{ category.name | lower | replace(' ', '-') }}">{{ category.name }}</a>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-9 col-md-9">
                        <div class="row property__gallery">
                            {% for category_name, products in categorized_products.items() %}
                                {% for product in products %}
                                    <div class="col-lg-4 col-md-6 mix {{ category_name | lower | replace(' ', '-') }}">
                                        <div class="product__item">
                                            <div class="product__item__pic set-bg" data-setbg="data:image/png;base64,{{ product.image_url | b64encode }}">
                                                <ul class="product__hover">
                                                    <li><a href="data:image/png;base64,{{ product.image_url | b64encode }}" class="image-popup"><span class="arrow_expand"></span></a></li>
                                                </ul>
                                            </div>
                                            <div class="product__item__text">
                                                <h6><a href="url_for('main.productDetails', product_id=product['product_id'])">{{ product.name }}</a></h6>
                                                <div class="product__price">${{ product.price }}</div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% endfor %}
                            <div class="col-lg-12 text-center">
                                <div class="pagination__option">
                                    <a href="#">1</a>
                                    <a href="#">2</a>
                                    <a href="#">3</a>
                                    <a href="#"><i class="fa fa-angle-right"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Shop Section End -->
    {% endblock %}


    <!-- Product Section Begin
    <section class="shop spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-4">
                    <div class="section-title">
                        <h4>Products</h4>
                    </div>
                </div>
                <div class="col-lg-8 col-md-8">
                    <ul class="filter__controls">
                        {% for category in categories %}
                            <li data-filter=".{{ category.name | lower | replace(' ', '-') }}">{{ category.name }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="row property__gallery">
                {% for category, products in categorized_products.items() %}
                    {% for product in products %}
                        <div class="col-lg-3 col-md-4 col-sm-6 mix {{ category | lower | replace(' ', '-') }}">
                            <div class="product__item">
                                <div class="product__item__pic set-bg" data-setbg="data:image/png;base64,{{ product.image_url | b64encode }}">
                                    <ul class="product__hover">
                                        <li><a href="data:image/png;base64,{{ product.image_url | b64encode }}" class="image-popup"><span class="arrow_expand"></span></a></li>
                                    </ul>
                                </div>
                                <div class="product__item__text">
                                    <h6><a href="#">{{ product.name }}</a></h6>
                                    <div class="product__price">${{ product.price }}</div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
    </section> -->
    <!-- Shop Section End -->
    {% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const categoryFilters = document.querySelectorAll('.category-filter');
            categoryFilters.forEach(filter => {
                filter.addEventListener('click', function() {
                    const filterValue = this.getAttribute('data-filter');
                    const products = document.querySelectorAll('.property__gallery .mix');
    
                    console.log(`Filtering products with value: ${filterValue}`); // Debugging statement
    
                    products.forEach(product => {
                        console.log(`Product classes: ${product.classList}`); // Debugging statement
                        if (filterValue === 'all' || product.classList.contains(filterValue)) {
                            product.style.display = 'block';
                        } else {
                            product.style.display = 'none';
                        }
                    });
                });
            });
    
            // Set background images for products
            const setBgElements = document.querySelectorAll('.set-bg');
            setBgElements.forEach(el => {
                const bg = el.getAttribute('data-setbg');
                el.style.backgroundImage = `url(${bg})`;
            });
        });
    </script>
    {% endblock %}